<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free EAN Code Generator</title>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4041775163958551"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 2em;
      background: #f4f4f4;
      color: #333;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 0.2em;
    }
    p {
      margin-top: 0;
      margin-bottom: 2em;
      color: #666;
    }
    input, select, button {
      margin: 0.5em auto;
      padding: 0.75em;
      width: 90%;
      max-width: 400px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      box-sizing: border-box;
      display: block;
    }
    button {
      background-color: #007acc;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #005fa3;
    }
    svg {
      margin-top: 1em;
      display: block;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
      width: 300px;
      height: 150px;
    }
    .download-btn {
      background-color: #28a745;
      margin-top: 0.5em;
      max-width: 200px;
      width: 90%;
    }
    .download-btn:hover {
      background-color: #1e7e34;
    }
    .batch-section {
      margin-top: 3em;
      border-top: 2px solid #ccc;
      padding-top: 2em;
    }
    label {
      font-weight: bold;
      margin-top: 1em;
      display: block;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
      color: #444;
    }
    footer {
      margin-top: 4em;
      font-size: 0.85em;
      color: #888;
    }
    .sister-site-btn {
      display: block;
      clear: both;
      background: #ff6600;
      color: white;
      padding: 0.75em 1.5em;
      margin: 1em auto 2em auto;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      max-width: 400px;
      width: 90%;
      box-sizing: border-box;
      transition: background-color 0.3s ease;
      text-align: center;
    }
    .sister-site-btn:hover {
      background-color: #cc5200;
    }
  </style>
</head>
<body>
  <h1>Free EAN Code Generator</h1>
  <p>Generate valid EAN-8 or EAN-13 barcodes. Enter 7 digits for EAN-8 or 12 digits for EAN-13 and generate instantly.</p>

  <!-- Single EAN input -->
  <label for="ean-input">Enter EAN Code (7 digits for EAN-8 or 12 digits for EAN-13):</label>
  <input id="ean-input" type="text" placeholder="Enter 7 or 12 digits" maxlength="12" />
  <button onclick="handleSingleGenerate()">Generate & Download Single EAN Barcode</button>

  <svg id="ean-svg" aria-label="EAN barcode"></svg>
  <button id="download-single-btn" class="download-btn" style="display:none;">Download Barcode PNG</button>

  <!-- Batch EAN generator -->
  <div class="batch-section">
    <h2>Batch Generate & Download EAN Codes</h2>

    <label for="ean-type-batch">Select EAN Type:</label>
    <select id="ean-type-batch">
      <option value="ean13" selected>EAN-13 (12 digits base)</option>
      <option value="ean8">EAN-8 (7 digits base)</option>
    </select>

    <label for="ean-count">Number of Codes to Generate (1 to 100):</label>
    <input id="ean-count" type="number" placeholder="Enter count" min="1" max="100" />

    <button onclick="generateAndDownloadBatch()">Generate & Download Batch as ZIP</button>
  </div>

  <a href="https://www.free-qr-maker.com" target="_blank" rel="noopener noreferrer" class="sister-site-btn">
    Try our Free QR Code Generator!
  </a>

  <footer>
    Free EAN Maker. Made with ❤️
  </footer>

  <script>
    // Calculate checksum digit
    function calculateChecksum(code) {
      let sum = 0;
      for (let i = 0; i < code.length; i++) {
        sum += parseInt(code[i], 10) * (i % 2 === 0 ? 1 : 3);
      }
      return (10 - (sum % 10)) % 10;
    }

    // Render barcode to SVG element
    function renderEANToSVG(code, svgId = 'ean-svg', format = 'ean13') {
      const svg = document.getElementById(svgId);
      svg.innerHTML = ''; // Clear previous barcode
      JsBarcode(svg, code, { format, displayValue: true, width: 2, height: 100 });
    }

    // Convert SVG element to PNG Blob
    function svgToPngBlob(svgElement, width = 300, height = 150) {
      return new Promise((resolve, reject) => {
        const svgData = new XMLSerializer().serializeToString(svgElement);
        const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
        const url = URL.createObjectURL(svgBlob);

        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = 'white';  // Optional: white background
          ctx.fillRect(0, 0, width, height);
          ctx.drawImage(img, 0, 0, width, height);
          URL.revokeObjectURL(url);
          canvas.toBlob(blob => {
            resolve(blob);
          }, 'image/png');
        };
        img.onerror = () => {
          reject(new Error('Failed to convert SVG to PNG'));
        };
        img.src = url;
      });
    }

    // Handle single barcode generation and enable download button
    function handleSingleGenerate() {
      const value = document.getElementById('ean-input').value.trim();
      const downloadBtn = document.getElementById('download-single-btn');

      if (!/^\d+$/.test(value)) {
        alert('Please enter only digits.');
        return;
      }

      let format = '';
      if (value.length === 7) {
        format = 'ean8';
      } else if (value.length === 12) {
        format = 'ean13';
      } else {
        alert('Please enter exactly 7 digits for EAN-8 or 12 digits for EAN-13.');
        return;
      }

      const fullCode = value + calculateChecksum(value);
      renderEANToSVG(fullCode, 'ean-svg', format);

      // Show and prepare the download button
      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = () => {
        const svg = document.getElementById('ean-svg');
        svgToPngBlob(svg).then(blob => {
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `${fullCode}.png`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      };
    }

    // Generate random base code of given length (digits only)
    function generateRandomBase(length) {
      return Math.floor(Math.random() * Math.pow(10, length)).toString().padStart(length, '0');
    }

    // Batch generation and ZIP download
    function generateAndDownloadBatch() {
      const count = parseInt(document.getElementById('ean-count').value, 10);
      if (isNaN(count) || count < 1 || count > 100) {
        alert('Please enter a number between 1 and 100.');
        return;
      }

      const type = document.getElementById('ean-type-batch').value;
      const baseLength = type === 'ean13' ? 12 : 7;

      const zip = new JSZip();
      const promises = [];

      for (let i = 0; i < count; i++) {
        const base = generateRandomBase(baseLength);
        const fullCode = base + calculateChecksum(base);

        // Create off-DOM SVG element
        const tempSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        tempSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
        tempSvg.setAttribute('width', '300');
        tempSvg.setAttribute('height', '150');

        JsBarcode(tempSvg, fullCode, { format: type, displayValue: true, width: 2, height: 100 });

        const p = svgToPngBlob(tempSvg).then(blob => {
          zip.file(`${fullCode}.png`, blob);
        });

        promises.push(p);
      }

      Promise.all(promises).then(() => {
        zip.generateAsync({ type: 'blob' }).then(content => {
          saveAs(content, `${type}-codes.zip`);
        });
      });
    }
  </script>
</body>
</html>
