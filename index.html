<!DOCTYPE html>More actions
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Generate barcodes including EAN-13, EAN-8, Codabar, Pharmacode, and more. Download as PNG or JPEG. Free, fast, no signup.">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Generate barcodes including EAN-13, EAN-8, Codabar, Pharmacode, and more. Download as PNG or ZIP. Free, fast, no signup.">
  <meta name="keywords" content="barcode generator, free barcode, create barcode, download barcode, ean code">
  <meta name="author" content="Free Barcode Maker">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://free-ean-maker.com/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://free-ean-maker.com/">
  <meta property="og:title" content="Free Barcode Generator">
  <meta property="og:description" content="Create and download barcodes instantly for free. No signup required.">
  <meta property="og:image" content="https://free-ean-maker.com/preview.jpg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://free-ean-maker.com/">
  <meta property="twitter:title" content="Free Barcode Generator">
@@ -53,7 +51,7 @@

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7ff 0%, #f0f4ff 100%);
      background: linear-gradient(135deg, var(--light) 0%, #f0f4ff 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
@@ -110,7 +108,7 @@
    }

    .feature {
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 25px;
      text-align: center;
@@ -144,7 +142,7 @@
    }

    .card {
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
@@ -236,7 +234,7 @@
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid var(--light-gray);
      background: white;
      background: var(--light);
      display: block;
      transition: var(--transition);
      font-family: 'Poppins', sans-serif;
@@ -272,7 +270,7 @@
      display: block;
      max-width: 100%;
      border-radius: 12px;
      background: white;
      background: var(--light);
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--light-gray);
@@ -366,7 +364,7 @@
    }

    .guide-section {
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 40px;
      margin: 40px auto;
@@ -453,7 +451,7 @@
    }

    .sister-tool {
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 25px;
      text-align: center;
@@ -463,7 +461,7 @@

    .sister-tool:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0,0.1);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .sister-tool i {
@@ -498,7 +496,7 @@
      padding: 12px 25px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
      font-weight: 600;
      transition: var(--transition);
    }

@@ -520,16 +518,15 @@
    footer p {
      margin-bottom: 10px;
    }
    
    /* Cookie Consent Styles */

    #cookie-consent {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 800px;
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.15);
      padding: 20px;
@@ -615,7 +612,6 @@
      color: var(--dark);
    }

    /* Cookie Settings Modal */
    #cookie-settings {
      position: fixed;
      top: 0;
@@ -630,7 +626,7 @@
    }

    .settings-modal {
      background: white;
      background: var(--light);
      border-radius: var(--border-radius);
      width: 95%;
      max-width: 600px;
@@ -843,7 +839,6 @@
  </style>
</head>
<body>
  <!-- Cookie Consent Banner -->
  <div id="cookie-consent">
    <div class="cookie-content">
      <div class="cookie-text">
@@ -859,12 +854,11 @@
    </div>
  </div>

  <!-- Cookie Settings Modal -->
  <div id="cookie-settings">
    <div class="settings-modal">
      <div class="settings-header">
        <h2><i class="fas fa-cookie-bite"></i> Cookie Settings</h2>
        <button class="close-settings">&times;</button>
        <button class="close-settings" aria-label="Close cookie settings">×</button>
      </div>
      <div class="settings-content">
        <p>You can set your preferences for how we and our partners use cookies and similar technologies.</p>
@@ -873,7 +867,7 @@ <h2><i class="fas fa-cookie-bite"></i> Cookie Settings</h2>
          <div class="cookie-type-header">
            <h3>Essential Cookies</h3>
            <div class="toggle-switch">
              <input type="checkbox" id="essential-toggle" checked disabled>
              <input type="checkbox" id="essential-toggle" checked disabled aria-label="Essential cookies toggle (always enabled)">
              <span class="slider"></span>
            </div>
          </div>
@@ -884,7 +878,7 @@ <h3>Essential Cookies</h3>
          <div class="cookie-type-header">
            <h3>Analytics Cookies</h3>
            <div class="toggle-switch">
              <input type="checkbox" id="analytics-toggle">
              <input type="checkbox" id="analytics-toggle" aria-label="Analytics cookies toggle">
              <span class="slider"></span>
            </div>
          </div>
@@ -895,7 +889,7 @@ <h3>Analytics Cookies</h3>
          <div class="cookie-type-header">
            <h3>Advertising Cookies</h3>
            <div class="toggle-switch">
              <input type="checkbox" id="advertising-toggle">
              <input type="checkbox" id="advertising-toggle" aria-label="Advertising cookies toggle">
              <span class="slider"></span>
            </div>
          </div>
@@ -965,22 +959,22 @@ <h3><i class="fas fa-download"></i> Download</h3>
    </div>

    <div class="card">
      <div class="tabs">
        <div class="tab active" data-tab="single">
      <div class="tabs" role="tablist">
        <div class="tab active" data-tab="single" role="tab" aria-selected="true" tabindex="0">
          <i class="fas fa-barcode"></i> Single Barcode
        </div>
        <div class="tab" data-tab="batch">
        <div class="tab" data-tab="batch" role="tab" aria-selected="false" tabindex="0">
          <i class="fas fa-layer-group"></i> Batch Barcodes
        </div>
        <div class="tab" data-tab="custom">
        <div class="tab" data-tab="custom" role="tab" aria-selected="false" tabindex="0">
          <i class="fas fa-cog"></i> Custom Barcodes
        </div>
      </div>

      <div class="tab-content active" id="single-tab">
      <div class="tab-content active" id="single-tab" role="tabpanel">
        <h2><i class="fas fa-barcode"></i> Generate Single Barcode</h2>
        <label for="ean-type">Barcode Type:</label>
        <select id="ean-type">
        <select id="ean-type" aria-label="Select barcode type">
          <option value="ean13" selected>EAN-13</option>
          <option value="ean8">EAN-8</option>
          <option value="code128">Code 128</option>
@@ -992,28 +986,28 @@ <h2><i class="fas fa-barcode"></i> Generate Single Barcode</h2>
          <option value="pharmacode">Pharmacode</option>
        </select>
        <label for="ean-input">Barcode Value:</label>
        <input id="ean-input" type="text" placeholder="Enter barcode or leave blank to auto-generate" autofocus>
        <input id="ean-input" type="text" placeholder="Enter barcode or leave blank to auto-generate" autofocus aria-label="Enter barcode value">
        <div class="error" id="single-error"></div>
        <div class="success" id="single-success"></div>
        <div class="btn-group">
          <button onclick="generateSingleEAN()">
          <button id="generate-single-btn" aria-label="Generate barcode">
            <i class="fas fa-bolt"></i> Generate Barcode
          </button>
          <button id="download-btn" style="display:none" onclick="downloadSingleEAN()">
          <button id="download-btn" style="display:none" aria-label="Download barcode">
            <i class="fas fa-download"></i> Download
          </button>
        </div>
        <div class="loading" id="single-loading">
          <div class="spinner"></div>
          Generating Barcode...
        </div>
        <canvas id="ean-canvas" style="display: none;"></canvas>
        <canvas id="ean-canvas" style="display: none;" aria-label="Generated barcode"></canvas>
      </div>

      <div class="tab-content" id="batch-tab">
      <div class="tab-content" id="batch-tab" role="tabpanel">
        <h2><i class="fas fa-layer-group"></i> Batch Barcode Generation</h2>
        <label for="batch-ean-type">Barcode Type:</label>
        <select id="batch-ean-type">
        <select id="batch-ean-type" aria-label="Select barcode type for batch generation">
          <option value="ean13" selected>EAN-13</option>
          <option value="ean8">EAN-8</option>
          <option value="code128">Code 128</option>
@@ -1025,9 +1019,9 @@ <h2><i class="fas fa-layer-group"></i> Batch Barcode Generation</h2>
          <option value="pharmacode">Pharmacode</option>
        </select>
        <label for="batch-amount">Number of Barcodes:</label>
        <input id="batch-amount" type="number" min="1" max="100" placeholder="Enter number of codes (1–100)" />
        <input id="batch-amount" type="number" min="1" max="100" placeholder="Enter number of codes (1–100)" aria-label="Enter number of barcodes">
        <div class="btn-group">
          <button onclick="generateBatchEANs()">
          <button id="generate-batch-btn" aria-label="Generate and download batch barcodes as ZIP">
            <i class="fas fa-file-archive"></i> Generate & Download as ZIP
          </button>
        </div>
@@ -1039,33 +1033,33 @@ <h2><i class="fas fa-layer-group"></i> Batch Barcode Generation</h2>
        <div class="error" id="batch-error"></div>
      </div>

      <div class="tab-content" id="custom-tab">
      <div class="tab-content" id="custom-tab" role="tabpanel">
        <h2><i class="fas fa-cog"></i> Custom Barcode Generator</h2>
        <label for="custom-type">Barcode Type:</label>
        <select id="custom-type">
        <select id="custom-type" aria-label="Select custom barcode type">
          <option value="code128">Code 128</option>
          <option value="code39">Code 39</option>
          <option value="codabar">Codabar</option>
          <option value="msi">MSI</option>
          <option value="pharmacode">Pharmacode</option>
        </select>
        <label for="custom-input">Custom Text:</label>
        <input id="custom-input" type="text" placeholder="Enter custom text for barcode" />
        <input id="custom-input" type="text" placeholder="Enter custom text for barcode" aria-label="Enter custom text for barcode">
        <div class="format-info">
          <h3>Format Examples:</h3>
          <ul>
            <li><strong>Code 128:</strong> Alphanumeric (e.g., ABC123)</li>
            <li><strong>Code 39:</strong> Alphanumeric (e.g., CODE39)</li>
            <li><strong>Code 39:</strong> Alphanumeric, uppercase (e.g., CODE39)</li>
            <li><strong>Codabar:</strong> Start/end with A-D, digits and -$:/.+ (e.g., A12345B)</li>
            <li><strong>MSI:</strong> Numeric only (e.g., 123456)</li>
            <li><strong>Pharmacode:</strong> Numbers 3-131070 (e.g., 1234)</li>
          </ul>
        </div>
        <div class="btn-group">
          <button onclick="generateCustomBarcode()">
          <button id="generate-custom-btn" aria-label="Generate custom barcode">
            <i class="fas fa-bolt"></i> Generate Custom Barcode
          </button>
          <button id="custom-download" style="display:none" onclick="downloadCustomBarcode()">
          <button id="custom-download" style="display:none" aria-label="Download custom barcode">
            <i class="fas fa-download"></i> Download
          </button>
        </div>
@@ -1075,7 +1069,7 @@ <h3>Format Examples:</h3>
        </div>
        <div class="error" id="custom-error"></div>
        <div class="success" id="custom-success"></div>
        <canvas id="custom-canvas" style="display: none;"></canvas>
        <canvas id="custom-canvas" style="display: none;" aria-label="Generated custom barcode"></canvas>
      </div>
    </div>

@@ -1158,480 +1152,375 @@ <h3>Free Video Toolkit</h3>
  </div>

  <script>
    // Cookie Management Functions
    const COOKIE_CONSENT_KEY = 'cookieConsent';
    
    // Get current cookie preferences
    const elements = {
      tabs: document.querySelectorAll('.tab'),
      tabContents: document.querySelectorAll('.tab-content'),
      singleCanvas: document.getElementById('ean-canvas'),
      customCanvas: document.getElementById('custom-canvas'),
      downloadBtn: document.getElementById('download-btn'),
      customDownloadBtn: document.getElementById('custom-download'),
      singleLoading: document.getElementById('single-loading'),
      batchLoading: document.getElementById('batch-loading'),
      customLoading: document.getElementById('custom-loading'),
      batchProgress: document.getElementById('batch-progress'),
      singleError: document.getElementById('single-error'),
      batchError: document.getElementById('batch-error'),
      customError: document.getElementById('custom-error'),
      singleSuccess: document.getElementById('single-success'),
      batchSuccess: document.getElementById('batch-success'),
      customSuccess: document.getElementById('custom-success'),
      eanType: document.getElementById('ean-type'),
      eanInput: document.getElementById('ean-input'),
      batchEanType: document.getElementById('batch-ean-type'),
      batchAmount: document.getElementById('batch-amount'),
      customType: document.getElementById('custom-type'),
      customInput: document.getElementById('custom-input'),
      generateSingleBtn: document.getElementById('generate-single-btn'),
      generateBatchBtn: document.getElementById('generate-batch-btn'),
      generateCustomBtn: document.getElementById('generate-custom-btn'),
      acceptCookies: document.getElementById('accept-cookies'),
      rejectCookies: document.getElementById('reject-cookies'),
      openSettings: document.getElementById('open-settings'),
      openSettingsFooter: document.getElementById('open-settings-footer'),
      closeSettings: document.querySelector('.close-settings'),
      saveSettings: document.getElementById('save-settings'),
      cookieConsent: document.getElementById('cookie-consent'),
      cookieSettings: document.getElementById('cookie-settings'),
      analyticsToggle: document.getElementById('analytics-toggle'),
      advertisingToggle: document.getElementById('advertising-toggle')
    };

    const barcodeConfig = {
      ean13: { length: 12, regex: /^\d{12,13}$/, format: 'ean13' },
      ean8: { length: 7, regex: /^\d{7,8}$/, format: 'ean8' },
      upc: { length: 11, regex: /^\d{11,12}$/, format: 'UPC' },
      itf14: { length: 13, regex: /^\d{13,14}$/, format: 'itf14' },
      code128: { regex: /^[\w\s-]+$/, format: 'code128' },
      code39: { regex: /^[0-9A-Z\s-.%*+$/]+$/, format: 'code39' },
      codabar: { regex: /^[A-D][0-9-:$/.+]*[A-D]$/, format: 'codabar' },
      msi: { regex: /^\d+$/, format: 'msi' },
      pharmacode: { min: 3, max: 131070, regex: /^\d+$/, format: 'pharmacode' }
    };

    function getCookiePreferences() {
      const preferences = localStorage.getItem(COOKIE_CONSENT_KEY);
      return preferences ? JSON.parse(preferences) : null;
    }
    
    // Save cookie preferences

    function saveCookiePreferences(preferences) {
      localStorage.setItem(COOKIE_CONSENT_KEY, JSON.stringify(preferences));
    }
    
    // Show cookie consent banner if needed
    function checkCookieConsent() {
      const preferences = getCookiePreferences();
      
      if (!preferences) {
        // Show the consent banner if no preferences exist
        document.getElementById('cookie-consent').style.display = 'block';
      } else {
        // Load analytics/ads if user previously consented
        if (preferences.analytics) loadGoogleAnalytics();
        if (preferences.advertising) loadGoogleAdSense();
      }
    }
    
    // Load Google Analytics

    function loadGoogleAnalytics() {
      if (window.gaLoaded) return;
      
      // Create gtag script
      const gtagScript = document.createElement('script');
      gtagScript.async = true;
      gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-C4SSJKXG4Z';
      document.head.appendChild(gtagScript);
      
      // Initialize dataLayer and gtag
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C4SSJKXG4Z');
      
      window.gaLoaded = true;
      console.log('Google Analytics loaded');
    }
    
    // Load Google AdSense

    function loadGoogleAdSense() {
      if (window.adsenseLoaded) return;
      
      const adsenseScript = document.createElement('script');
      adsenseScript.async = true;
      adsenseScript.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4041775163958551';
      adsenseScript.crossOrigin = 'anonymous';
      document.head.appendChild(adsenseScript);
      
      window.adsenseLoaded = true;
      console.log('Google AdSense loaded');
    }
    
    // Initialize cookie consent
    document.addEventListener('DOMContentLoaded', function() {
      // Set up cookie consent banner
      checkCookieConsent();
      
      // Event listeners for consent buttons
      document.getElementById('accept-cookies').addEventListener('click', function() {
        // Save preferences
        saveCookiePreferences({
          essential: true,
          analytics: true,
          advertising: true
        });
        
        // Hide banner
        document.getElementById('cookie-consent').style.display = 'none';
        
        // Load analytics and ads
        loadGoogleAnalytics();
        loadGoogleAdSense();
      });
      
      document.getElementById('reject-cookies').addEventListener('click', function() {
        // Save preferences (only essential cookies)
        saveCookiePreferences({
          essential: true,
          analytics: false,
          advertising: false
        });
        
        // Hide banner
        document.getElementById('cookie-consent').style.display = 'none';
      });
      
      // Open cookie settings
      document.getElementById('open-settings').addEventListener('click', openCookieSettings);
      document.getElementById('open-settings-footer').addEventListener('click', function(e) {
        e.preventDefault();
        openCookieSettings();
      });
      
      // Close cookie settings
      document.querySelector('.close-settings').addEventListener('click', closeCookieSettings);
      
      // Save cookie settings
      document.getElementById('save-settings').addEventListener('click', function() {
        const preferences = {
          essential: true,
          analytics: document.getElementById('analytics-toggle').checked,
          advertising: document.getElementById('advertising-toggle').checked
        };
        
        saveCookiePreferences(preferences);
        
        // Reload analytics/ads based on new preferences
        if (preferences.analytics) {
          loadGoogleAnalytics();
        }
        
        if (preferences.advertising) {
          loadGoogleAdSense();
        }
        
        closeCookieSettings();
        document.getElementById('cookie-consent').style.display = 'none';
      });
    });
    
    function openCookieSettings() {

    function checkCookieConsent() {
      const preferences = getCookiePreferences();
      
      // Set toggle states based on saved preferences
      if (preferences) {
        document.getElementById('analytics-toggle').checked = preferences.analytics;
        document.getElementById('advertising-toggle').checked = preferences.advertising;
      if (!preferences) {
        elements.cookieConsent.style.display = 'block';
      } else {
        // Default to all on for new users
        document.getElementById('analytics-toggle').checked = true;
        document.getElementById('advertising-toggle').checked = true;
        if (preferences.analytics) loadGoogleAnalytics();
        if (preferences.advertising) loadGoogleAdSense();
      }
      
      document.getElementById('cookie-settings').style.display = 'flex';
    }
    
    function closeCookieSettings() {
      document.getElementById('cookie-settings').style.display = 'none';
    }

    // DOM Elements
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const singleCanvas = document.getElementById('ean-canvas');
    const customCanvas = document.getElementById('custom-canvas');
    const downloadBtn = document.getElementById('download-btn');
    const customDownloadBtn = document.getElementById('custom-download');
    const singleLoading = document.getElementById('single-loading');
    const batchLoading = document.getElementById('batch-loading');
    const customLoading = document.getElementById('custom-loading');
    const batchProgress = document.getElementById('batch-progress');
    const singleError = document.getElementById('single-error');
    const batchError = document.getElementById('batch-error');
    const customError = document.getElementById('custom-error');
    const singleSuccess = document.getElementById('single-success');
    const batchSuccess = document.getElementById('batch-success');
    const customSuccess = document.getElementById('custom-success');
    const eanType = document.getElementById('ean-type');
    const eanInput = document.getElementById('ean-input');
    const batchEanType = document.getElementById('batch-ean-type');
    const batchAmount = document.getElementById('batch-amount');
    const customType = document.getElementById('custom-type');
    const customInput = document.getElementById('custom-input');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Tab switching
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        });
      });

      // Generate on Enter key
      eanInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          generateSingleEAN();
        }
      });
    function openCookieSettings() {
      const preferences = getCookiePreferences();
      elements.analyticsToggle.checked = preferences ? preferences.analytics : true;
      elements.advertisingToggle.checked = preferences ? preferences.advertising : true;
      elements.cookieSettings.style.display = 'flex';
    }

      customInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          generateCustomBarcode();
        }
      });
    });
    function closeCookieSettings() {
      elements.cookieSettings.style.display = 'none';
    }

    // Helper to show error
    function showError(element, message) {
      element.textContent = message;
      element.style.display = 'block';
    }

    // Helper to show success
    function showSuccess(element, message) {
      element.textContent = message;
      element.style.display = 'block';
    }

    // Helper to hide elements
    function hideElements() {
      document.querySelectorAll('.error, .success').forEach(el => {
        el.style.display = 'none';
      });
      [elements.singleError, elements.batchError, elements.customError,
       elements.singleSuccess, elements.batchSuccess, elements.customSuccess]
        .forEach(el => el.style.display = 'none');
    }

    // Calculate checksum
    function calculateChecksum(code, type) {
      let sum = 0;
      if (type === 'ean8') {
        const weights = [3, 1, 3, 1, 3, 1, 3];
        for (let i = 0; i < code.length; i++) {
          sum += parseInt(code[i]) * weights[i];
        }
      } else if (type === 'upc') {
        for (let i = 0; i < code.length; i++) {
          sum += parseInt(code[i]) * (i % 2 === 0 ? 3 : 1);
        }
      } else if (type === 'itf14') {
        for (let i = 0; i < code.length; i++) {
          sum += parseInt(code[i]) * (i % 2 === 0 ? 3 : 1);
        }
        for (let i = 0; i < code.length; i++) sum += parseInt(code[i]) * weights[i];
      } else if (type === 'upc' || type === 'itf14') {
        for (let i = 0; i < code.length; i++) sum += parseInt(code[i]) * (i % 2 === 0 ? 3 : 1);
      } else {
        const weights = [1, 3];
        for (let i = 0; i < code.length; i++) {
          sum += parseInt(code[i]) * weights[i % 2];
        }
        for (let i = 0; i < code.length; i++) sum += parseInt(code[i]) * weights[i % 2];
      }
      return (10 - (sum % 10)) % 10;
    }

    // Generate random EAN
    function generateRandomEAN(type) {
      const length = type === 'ean8' ? 7 : type === 'upc' ? 11 : type === 'itf14' ? 13 : 12;
      let base = '';
      for (let i = 0; i < length; i++) {
        base += Math.floor(Math.random() * 10);
      }
      const { length } = barcodeConfig[type];
      let base = Array.from({ length }, () => Math.floor(Math.random() * 10)).join('');
      return base + calculateChecksum(base, type);
    }

    // Generate random barcode
    function validateInput(code, type) {
      const config = barcodeConfig[type];
      if (!code) return true;
      if (type === 'pharmacode') {
        const num = parseInt(code);
        return !isNaN(num) && num >= config.min && num <= config.max;
      }
      return config.regex.test(code);
    }

    function generateRandomBarcode(type) {
      if (['ean13', 'ean8', 'upc', 'itf14'].includes(type)) {
        return generateRandomEAN(type);
      }
      switch (type) {
        case 'ean13':
        case 'ean8':
        case 'upc':
        case 'itf14':
          return generateRandomEAN(type);
        case 'code128':
        case 'code39':
        case 'msi':
          return Math.random().toString().slice(2, 12);
          return Math.random().toString(36).slice(2, 12).toUpperCase();
        case 'codabar':
          return 'A' + Math.floor(Math.random() * 100000).toString().padStart(5, '0') + 'B';
          return `A${Math.floor(Math.random() * 100000).toString().padStart(5, '0')}B`;
        case 'pharmacode':
          return Math.floor(Math.random() * (131070 - 3 + 1) + 3).toString();
          return Math.floor(Math.random() * (barcodeConfig.pharmacode.max - barcodeConfig.pharmacode.min + 1) + barcodeConfig.pharmacode.min).toString();
        default:
          return '123456';
      }
    }

    // Generate single EAN
    function generateSingleEAN() {
      const type = eanType.value;
      const ctx = singleCanvas.getContext('2d');
    function sanitizeFilename(str) {
      return str.replace(/[^a-zA-Z0-9-]+/g, '_').slice(0, 50) || 'barcode';
    }

      // Reset
    function generateBarcode({ canvas, code, type, errorElement, successElement, downloadButton, loadingElement }) {
      const ctx = canvas.getContext('2d');
      hideElements();
      singleLoading.style.display = 'block';
      downloadBtn.style.display = 'none';
      singleCanvas.style.display = 'none';

      setTimeout(() => {
        // Reset canvas
        singleCanvas.width = 0;
        singleCanvas.height = 0;

        singleCanvas.width = 400;
        singleCanvas.height = type === 'pharmacode' ? 100 : 150;
        ctx.clearRect(0, 0, singleCanvas.width, singleCanvas.height);

        let code = eanInput.value.trim();

        const expectedLength = {
          ean13: 13,
          ean8: 8,
          upc: 12,
          itf14: 14
        }[type] || null;

        // Clear input only if we're generating a new barcode
        if (type === 'pharmacode') {
          const numCode = parseInt(code);
          if (!code || isNaN(numCode) || numCode < 3 || numCode > 131070) {
            code = generateRandomBarcode(type);
          }
        } else if (!code || (expectedLength && code.length !== expectedLength)) {
            code = generateRandomBarcode(type);
        }

        // Store the code for download
        singleCanvas.dataset.code = code;
      loadingElement.style.display = 'block';
      downloadButton.style.display = 'none';
      canvas.style.display = 'none';

        try {
          let format = type;
          if (type === 'upc') format = 'upc';

          JsBarcode('#ean-canvas', code, {
            format: format,
            displayValue: true,
            width: type === 'pharmacode' ? 2 : 2,
            height: type === 'pharmacode' ? 50 : 100
          });
      if (!validateInput(code, type)) {
        showError(errorElement, 'Invalid input format for selected barcode type');
        loadingElement.style.display = 'none';
        return;
      }

          downloadBtn.style.display = 'inline-block';
          singleCanvas.style.display = 'block';
          showSuccess(singleSuccess, 'Barcode generated successfully!');
        } catch (err) {
          showError(singleError, 'Failed to generate barcode: ' + err.message);
        }
      const finalCode = code || generateRandomBarcode(type);
      const isPharmacode = type === 'pharmacode';
      canvas.width = 320;
      canvas.height = isPharmacode ? 100 : 150;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      canvas.dataset.code = finalCode;

        singleLoading.style.display = 'none';
      }, 300);
      try {
        JsBarcode(canvas, finalCode, {
          format: barcodeConfig[type].format,
          displayValue: true,
          width: isPharmacode ? 2 : 2,
          height: isPharmacode ? 50 : 100
        });
        downloadButton.style.display = 'inline-block';
        canvas.style.display = 'block';
        showSuccess(successElement, 'Barcode generated successfully!');
      } catch (error) {
        showError(errorElement, `Failed to generate barcode: ${error.message}`);
      } finally {
        loadingElement.style.display = 'none';
      }
    }

    // Download single EAN
    function downloadSingleEAN() {
      const code = singleCanvas.dataset.code || 'barcode';
      const link = document.createElement('a');
      link.download = `${code}.png`;
      link.href = singleCanvas.toDataURL('image/png');
      link.click();
    function downloadBarcode(canvas, errorElement) {
      try {
        const code = canvas.dataset.code;
        const link = document.createElement('a');
        link.download = `${sanitizeFilename(code)}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (error) {
        showError(errorElement, 'Error downloading barcode');
      }
    }

    // Generate batch EANs
    async function generateBatchEANs() {
      const type = batchEanType.value;
      const amount = parseInt(batchAmount.value);
      const type = elements.batchEanType.value;
      const amount = parseInt(elements.batchAmount.value);

      if (isNaN(amount) || amount < 1 || amount > 100) {
        showError(batchError, 'Please enter a number between 1 and 100.');
        showError(elements.batchError, 'Please enter a number between 1 and 100');
        return;
      }

      // Reset
      hideElements();
      batchLoading.style.display = 'block';
      batchSuccess.style.display = 'none';
      batchError.style.display = 'none';
      elements.batchLoading.style.display = 'block';

      try {
        const zip = new JSZip();
        const canvas = document.createElement('canvas');
        const isPharmacode = type === 'pharmacode';

        for (let i = 0; i < amount; i++) {
          // Update progress
          batchProgress.textContent = `Generating barcodes: ${i + 1}/${amount}`;

          let code = generateRandomBarcode(type);
          if (type === 'pharmacode') {
            const numCode = parseInt(code);
            if (isNaN(numCode) || numCode < 3 || numCode > 131070) {
              code = Math.floor(Math.random() * (131070 - 3 + 1) + 3).toString();
            }
          }
          elements.batchProgress.textContent = `Generating barcodes: ${i + 1}/${amount}`;
          const code = generateRandomBarcode(type);
          canvas.width = 320;
          canvas.height = isPharmacode ? 100 : 150;

          try {
            canvas.width = 400;
            canvas.height = type === 'pharmacode' ? 100 : 150;

            let format = type;
            if (type === 'upc') format = 'upc';

            JsBarcode(canvas, code, {
              format: format,
              format: barcodeConfig[type].format,
              displayValue: true,
              width: type === 'pharmacode' ? 2 : 2,
              height: type === 'pharmacode' ? 50 : 100
              width: isPharmacode ? 2 : 2,
              height: isPharmacode ? 50 : 100
            });

            const dataUrl = canvas.toDataURL('image/png');
            const imgData = dataUrl.replace(/^data:image\/png;base64,/, '');
            zip.file(`${code}.png`, imgData, { base64: true });
            zip.file(`${sanitizeFilename(code)}.png`, imgData, { base64: true });
          } catch (err) {
            console.warn(`Skipped code ${code}: ${err.message}`);
            console.warn(`Error generating barcode for code ${code}: ${err.message}`);
          }

          // Add small delay to prevent UI freeze
          await new Promise(resolve => setTimeout(resolve, 50));
          await new Promise(resolve => setTimeout(resolve, 10));
        }

        const blob = await zip.generateAsync({ type: 'blob' });
        saveAs(blob, `batch-${type}.zip`);

        batchLoading.style.display = 'none';
        showSuccess(batchSuccess, `Successfully generated and downloaded ${amount} barcodes!`);
        saveAs(blob, `batch-${sanitizeFilename(type)}.zip`);
        showSuccess(elements.batchSuccess, `Successfully generated and downloaded ${amount} barcodes!`);
      } catch (error) {
        batchLoading.style.display = 'none';
        showError(batchError, 'Error creating ZIP file: ' + error.message);
        showError(elements.batchError, `Error creating ZIP file: ${error.message}`);
      } finally {
        elements.batchLoading.style.display = 'none';
      }
    }

    // Generate custom barcode
    function generateCustomBarcode() {
      const type = customType.value;
      const input = customInput.value;
      const ctx = customCanvas.getContext('2d');
    function initialize() {
      checkCookieConsent();

      elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          elements.tabs.forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
          });
          elements.tabContents.forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          tab.setAttribute('aria-selected', 'true');
          document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        });
        tab.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            tab.click();
          }
        });
      });

      elements.eanInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') elements.generateSingleBtn.click();
      });

      // Reset
      hideElements();
      customLoading.style.display = 'block';
      customDownloadBtn.style.display = 'none';
      customCanvas.style.display = 'none';
      elements.customInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') elements.generateCustomBtn.click();
      });

      elements.generateSingleBtn.addEventListener('click', () => generateBarcode({
        canvas: elements.singleCanvas,
        code: elements.eanInput.value.trim(),
        type: elements.eanType.value,
        errorElement: elements.singleError,
        successElement: elements.singleSuccess,
        downloadButton: elements.downloadBtn,
        loadingElement: elements.singleLoading
      }));

      setTimeout(() => {
        // Reset canvas
        customCanvas.width = 0;
        customCanvas.height = 0;
      elements.downloadBtn.addEventListener('click', () => downloadBarcode(elements.singleCanvas, elements.singleError));

        customCanvas.width = 400;
        customCanvas.height = 100;
        ctx.clearRect(0, 0, customCanvas.width, customCanvas.height);
      elements.generateBatchBtn.addEventListener('click', generateBatchEANs);

        let code = input.trim();
      elements.generateCustomBtn.addEventListener('click', () => {
        const code = elements.customInput.value.trim();
        if (!code) {
          showError(customError, 'Please enter custom text for the barcode');
          customLoading.style.display = 'none';
          showError(elements.customError, 'Please enter custom text for the barcode');
          return;
        }
        generateBarcode({
          canvas: elements.customCanvas,
          code,
          type: elements.customType.value,
          errorElement: elements.customError,
          successElement: elements.customSuccess,
          downloadButton: elements.customDownloadBtn,
          loadingElement: elements.customLoading
        });
      });

        // Store the code for download
        customCanvas.dataset.code = code;
      elements.customDownloadBtn.addEventListener('click', () => downloadBarcode(elements.customCanvas, elements.customError));

        try {
          JsBarcode('#custom-canvas', code, {
            format: type,
            displayValue: true,
            width: 2,
            height: 100
          });
      elements.acceptCookies.addEventListener('click', () => {
        saveCookiePreferences({ essential: true, analytics: true, advertising: true });
        elements.cookieConsent.style.display = 'none';
        loadGoogleAnalytics();
        loadGoogleAdSense();
      });

          customDownloadBtn.style.display = 'inline-block';
          customCanvas.style.display = 'block';
          showSuccess(customSuccess, 'Custom barcode generated successfully!');
        } catch (err) {
          showError(customError, 'Failed to generate custom barcode: ' + err.message);
        }
      elements.rejectCookies.addEventListener('click', () => {
        saveCookiePreferences({ essential: true, analytics: false, advertising: false });
        elements.cookieConsent.style.display = 'none';
      });

        customLoading.style.display = 'none';
      }, 300);
    }
      elements.openSettings.addEventListener('click', openCookieSettings);
      elements.openSettingsFooter.addEventListener('click', e => {
        e.preventDefault();
        openCookieSettings();
      });

      elements.closeSettings.addEventListener('click', closeCookieSettings);

    // Download custom barcode
    function downloadCustomBarcode() {
      const code = customCanvas.dataset.code || 'custom-barcode';
      const link = document.createElement('a');
      link.download = `${code}.png`;
      link.href = customCanvas.toDataURL('image/png');
      link.click();
      elements.saveSettings.addEventListener('click', () => {
        const preferences = {
          essential: true,
          analytics: elements.analyticsToggle.checked,
          advertising: elements.advertisingToggle.checked
        };
        saveCookiePreferences(preferences);
        if (preferences.analytics) loadGoogleAnalytics();
        if (preferences.advertising) loadGoogleAdSense();
        closeCookieSettings();
        elements.cookieConsent.style.display = 'none';
      });
    }

    document.addEventListener('DOMContentLoaded', initialize);
  </script>
</body>
</html>
